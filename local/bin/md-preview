#!/usr/bin/env sh

if [ $# != 1 ]; then
  printf >&2 "%s\n" "Usage: $(basename $0) <file>"
  exit 1
fi

if ! [ -f "$1" ]; then
  printf >&2 "File doesn't exist: %s\n" "$1"
fi

# Delete files from previous runs
for garbage in /tmp/md-export.*.html; do
  if [ -f "$garbage" ]; then
    rm "$garbage"
  fi
done

TEMP=$(mktemp)
FILE="/tmp/md-export$(printf "%s" "$TEMP" | sed 's/\///g; s/tmp//g').html"
mv "$TEMP" "$FILE"

md-compile "$1" > "$FILE" \
  && printf >&2 "%s\n" "Compiled to: $FILE" \
  && OPEN_GUI=1 open "$FILE"
