#!/usr/bin/env bash

if [ $# != 0 ]; then
  printf >&2 "%s\n" "Usage: $(basename $0)"
  exit 1
fi

is_git_dir() {
  [ -d .git ] || git rev-parse --git-dir 2>/dev/null >/dev/null
}

if ! is_git_dir; then
  printf >&2 "This directory is not part of a git repository.\n"
  exit 1
fi

# show status
git status -sb

# show help message
printf >&2 "Type 'h' for help.\n"

while [ ! "$exit" ]; do
  # change cursor to block
  printf >&2 '\e[ 2q'

  # prompt
  printf >&2 "Command => "
  read -n1 option
  printf >&2 "\n"

  # parse option
  case "$option" in
    a) (cd "$(realpath -m $(git rev-parse --git-dir)/..)" && git add .) ;;
    b) git branch ;;
    c) git commit ;;
    d) git diff HEAD ;;
    f) git fetch ;;
    i) git status -sb ;;
    l) git log --all --oneline ;;
    L) git log --all ;;
    p) git pull ;;
    q) exit=0 ;;
    r) git remote -v ;;
    s) git push ;;
    "") clear ;;
    "") exit=0 ;;
    h) cat >&2 <<EOF ;;
  i     info (git status -sb)
  a     stage all changes
  c     commit
  d     show diff
  p     pull
  s     push
  l     log (compact)
  L     log (full)
  f     fetch
  b     list branches
  r     list remotes
  q     exit
  ESC   exit
  h     show this message
EOF
    *) printf 'Invalid option: %q\n' "$option" ;;
  esac
done

exit "$exit"
