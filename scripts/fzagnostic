#!/usr/bin/env bash

# A wrapper for fzf and dmenu.
# Bashisms: arrays.

. "$(uselib std)"

while getopts "p:h:" o; do
  case "$o" in
    p) hasPrompt=1 prompt="$OPTARG" ;;
    h) hasHeight=1 height="$OPTARG" ;;
    *)
      printf >&2 "%s\n" "Usage: $(basename $0) [-p prompt] [-h height]"
      exit 1
      ;;
  esac
done

if [ ! -t 2 ] && exists dmenu; then
  [ "$hasPrompt" ] && prompt=(-p "$prompt") || prompt=()
  [ "$hasHeight" ] && height=(-l "$height") || height=()
  dmenu -F "${prompt[@]}" "${height[@]}"
elif [ -t 2 ] && exists fzf; then
  [ "$hasPrompt" ] && prompt=(--prompt "$prompt ") || prompt=()
  [ "$hasHeight" ] && height=(--height "$height") || height=()
  printf >&2 '\033[2 q' # change cursor to block
  fzf "${prompt[@]}" "${height[@]}"
else
  printf >&2 "%s\n" "Could not open dmenu or fzf."
  exit 1
fi
